"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[648],{1648:function(e,t,l){l.r(t),l.d(t,{default:function(){return E}});var a=l(6252),i=l(3577),s=l(9963);const o=e=>((0,a.dD)("data-v-69b65a7b"),e=e(),(0,a.Cn)(),e),u={class:"stockOut inner"},n={class:"box"},r={class:"head"},d=o((()=>(0,a._)("i",{class:"erp erpfanhui",style:{"font-size":"14px","margin-right":"5px",position:"relative",top:"-1px"}},null,-1))),m=(0,a.Uk)(" 返回"),p=o((()=>(0,a._)("span",{style:{position:"relative",top:"2px","font-size":"15px"}},"农资出库",-1))),g={class:"content"},h={class:"info"},c={class:"tag"},w={class:"info"},f={style:{color:"#409eff"}},y=o((()=>(0,a._)("span",null,"出库数量：",-1))),k={key:0},b=o((()=>(0,a._)("i",{style:{"font-size":"12px","margin-right":"5px"},class:"erp erpicon_tianjia"},null,-1))),_=(0,a.Uk)(" 添加 "),v={class:"item log"},x=o((()=>(0,a._)("span",{class:"must"},"*",-1))),V=(0,a.Uk)(" 出库类型： "),U=o((()=>(0,a._)("span",{class:"must"},"*",-1))),W=(0,a.Uk)(" 出库时间： "),C=o((()=>(0,a._)("span",{class:"must"},"*",-1))),D=(0,a.Uk)(" 领用人： "),B={class:"item"},L=o((()=>(0,a._)("p",{class:"title"},[(0,a._)("span",{class:"must"},"*"),(0,a.Uk)(" 单据、凭证、照片：")],-1))),T={class:"pics"},I=["src"],$=["onClick"],z={key:0,class:"upload"},j={key:1},R=o((()=>(0,a._)("i",{class:"erp erpshangchuan"},null,-1))),S=[R],N={key:2},K={class:"item"},q=o((()=>(0,a._)("p",{class:"title"},"备注：",-1))),P={class:"item"},H=(0,a.Uk)("提交");function O(e,t){const l=(0,a.up)("el-button"),o=(0,a.up)("el-input"),R=(0,a.up)("el-option"),O=(0,a.up)("el-select"),Y=(0,a.up)("el-date-picker"),A=(0,a.up)("el-progress"),Z=(0,a.up)("StockReg"),F=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("div",n,[(0,a._)("div",r,[(0,a.Wm)(l,{link:"",type:"primary",onClick:e.back},{default:(0,a.w5)((()=>[d,m])),_:1},8,["onClick"]),p]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",g,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.list,((s,u)=>((0,a.wg)(),(0,a.iD)("div",{class:"item",key:u},[(0,a._)("div",h,[(0,a._)("p",null,[(0,a._)("span",null,(0,i.zw)(s.agriculturalBo.title),1),(0,a._)("span",c,(0,i.zw)(s.agriculturalBo.agriculturalCategory),1)]),(0,a._)("p",null,(0,i.zw)(s.agriculturalBo.manufacturers),1),(0,a._)("p",null," 规格："+(0,i.zw)(s.agriculturalBo.agriculturalCount)+(0,i.zw)(s.agriculturalBo.unitweight)+"/"+(0,i.zw)(s.agriculturalBo.unitmeasurement),1)]),(0,a._)("div",w,[(0,a._)("p",f," 库存："+(0,i.zw)(s.agriculturalUnit)+(0,i.zw)(s.agriculturalBo.unitmeasurement)+" (共"+(0,i.zw)(s.agriculturalCount)+(0,i.zw)(s.agriculturalBo.unitweight)+") ",1),(0,a._)("p",null,[y,(0,a.Wm)(o,{size:"small",style:{width:"70px","margin-right":"10px"},modelValue:s.num,"onUpdate:modelValue":e=>s.num=e},null,8,["modelValue","onUpdate:modelValue"]),(0,a._)("span",null,(0,i.zw)(s.agriculturalBo.unitweight),1)]),0==u?((0,a.wg)(),(0,a.iD)("p",k,[(0,a.Wm)(l,{size:"small",type:"primary",onClick:t[0]||(t[0]=t=>e.showReg=!0)},{default:(0,a.w5)((()=>[b,_])),_:1})])):(0,a.kq)("",!0)])])))),128)),(0,a._)("div",v,[(0,a._)("p",null,[x,V,(0,a.Wm)(O,{modelValue:e.defaultType,"onUpdate:modelValue":t[1]||(t[1]=t=>e.defaultType=t),class:"m-2",style:{width:"220px"},placeholder:"请选择出库类型"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.typeList,(e=>((0,a.wg)(),(0,a.j4)(R,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,a._)("p",null,[U,W,(0,a.Wm)(Y,{modelValue:e.outInTime,"onUpdate:modelValue":t[2]||(t[2]=t=>e.outInTime=t),type:"datetime",placeholder:"请选择时间"},null,8,["modelValue"])]),(0,a.wy)((0,a._)("p",null,[C,D,(0,a.Wm)(O,{modelValue:e.userName,"onUpdate:modelValue":t[3]||(t[3]=t=>e.userName=t),class:"m-2",style:{width:"220px","margin-left":"14px"},placeholder:"请选择领用人"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.userlist,(e=>((0,a.wg)(),(0,a.j4)(R,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])],512),[[s.F8,e.defaultType==e.backUser]])]),(0,a._)("div",B,[L,(0,a._)("div",T,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.imgs,((t,l)=>((0,a.wg)(),(0,a.iD)("div",{class:"img",key:l},[(0,a._)("img",{src:t,alt:""},null,8,I),(0,a._)("i",{class:"erp erpguanbi",onClick:t=>e.removeImg(l)},null,8,$)])))),128)),e.imgs.length<2?((0,a.wg)(),(0,a.iD)("div",z,[e.uploading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("input",{key:0,onChange:t[4]||(t[4]=(...t)=>e.uploadFile&&e.uploadFile(...t)),ref:"file",type:"file"},null,544)),e.uploading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",j,S)),e.uploading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",N,"点击上传单据、凭证、照片")),e.uploading?((0,a.wg)(),(0,a.j4)(A,{key:3,width:"90",type:"circle",percentage:e.percentage},null,8,["percentage"])):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])]),(0,a._)("div",K,[q,(0,a.Wm)(o,{modelValue:e.note,"onUpdate:modelValue":t[5]||(t[5]=t=>e.note=t),rows:5,type:"textarea",placeholder:"输入备注内容"},null,8,["modelValue"])]),(0,a._)("div",P,[(0,a.Wm)(l,{type:"primary",onClick:e.submit,loading:e.submitting},{default:(0,a.w5)((()=>[H])),_:1},8,["onClick","loading"])])])),[[F,e.loading]])]),e.showReg?((0,a.wg)(),(0,a.j4)(Z,{key:0,title:"请选择要操作的农资",default:"1",onOnSubmit:e.onRegSubmit,onCloseReg:e.closeReg},null,8,["onOnSubmit","onCloseReg"])):(0,a.kq)("",!0)])}var Y=l(3483),A=l(9737),Z=l(5300),F={name:"stockOut",data(){return{loading:!1,list:[],defaultType:"",backUser:"",typeList:[],userlist:[],userName:"",num:"",outInTime:new Date,note:"",showReg:!1,uploading:!1,imgs:[],percentage:0,submitting:!1}},components:{StockReg:Z.Z},mounted(){let e=this;const t=async function(){e.loading=!0,await e.getDetail(),await e.getPutTypeList(),await e.getUserList(),e.loading=!1};t()},methods:{getDetail(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/agricultural-detail",{id:this.$route.query.id}).then((t=>{t.data.num="",this.list.push(t.data),e()}))}))},getPutTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farmLand/getOutboundType").then((t=>{this.typeList=t.data,t.data.map((e=>{"领用出库"==e.title&&(this.backUser=e.id)})),e()}))}))},getUserList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/task/getOrganizationUsers").then((t=>{this.userlist=t.data,e()}))}))},back(){this.$router.push("/erp/stock")},closeReg(){let e=setTimeout((()=>{this.showReg=!1,clearTimeout(e)}),500)},onRegSubmit(e){this.list=[...this.list,...e]},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,Y.Z)(e,`erp/materialsOut/${e.name}`).then((e=>{e.url&&(this.imgs.push(e.url),this.uploading=!1,this.percentage=0)}))},removeImg(e){console.log(e),this.imgs.splice(e,1)},submit(){let e=-1,t="",l=this.list.map(((l,a)=>(l.num||-1!=e||(e=a,t=l.agriculturalBo.title),{agriculturalCount:l.num,id:l.id,title:l.agriculturalBo.title})));A.T.confirm(`农资名称：${l.map((e=>e.title)).join("、")} <br> 确定要出库吗？`,"农资出库",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then((()=>{if(e>-1)return void this.$message.warning(`请输入 [ ${t} ] 的出库数量`);if(!this.defaultType)return void this.$message.warning("请选择出库类型");if(!this.outInTime)return void this.$message.warning("请选择出库时间");if(this.defaultType==this.backUser&&!this.userName)return void this.$message.warning("请输入退回人");if(this.imgs.length<=0)return void this.$message.warning("请上传凭证");let a="";this.typeList.map((e=>{e.id==this.defaultType&&(a=e.title)}));let i="";this.userName&&this.userlist.map((e=>{e.id==this.userName&&(i=e.name)})),this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/saveAgriculturalStorage",{agriculturalOutInBos:l,image:this.imgs.join(","),outInTime:this.outInTime,remark:this.note,type:1,workAid:this.userName,username:i,workType:this.defaultType,workTypeName:a}).then((e=>{if(200==e.code){this.$message.success("出库成功！");let e=setTimeout((()=>{this.$router.push("/erp/stock"),clearTimeout(e)}),800)}else this.$message.error("操作失败，请联系管理员！")}))})).catch((()=>{}))}}},M=l(8118);const Q=(0,M.Z)(F,[["render",O],["__scopeId","data-v-69b65a7b"]]);var E=Q},5300:function(e,t,l){l.d(t,{Z:function(){return v}});var a=l(6252),i=l(3577);const s=e=>((0,a.dD)("data-v-29667d18"),e=e(),(0,a.Cn)(),e),o={class:"stockReg"},u={class:"stockRegBoxInner"},n={class:"form"},r={class:"formBox"},d=s((()=>(0,a._)("span",null,"/",-1))),m={class:"submit"},p=(0,a.Uk)("提交"),g={class:"_import"},h={class:"search"},c=(0,a.Uk)("查询"),w={class:"submit"},f=(0,a.Uk)("提交");function y(e,t){const l=(0,a.up)("el-dialog"),s=(0,a.up)("el-input"),y=(0,a.up)("el-form-item"),k=(0,a.up)("el-option"),b=(0,a.up)("el-select"),_=(0,a.up)("el-col"),v=(0,a.up)("el-form"),x=(0,a.up)("el-button"),V=(0,a.up)("el-table-column"),U=(0,a.up)("el-table"),W=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showDetailBox,"onUpdate:modelValue":t[2]||(t[2]=t=>e.showDetailBox=t),title:"请选择登记方式",width:"400px"},{default:(0,a.w5)((()=>[(0,a._)("div",u,[e.$store.state.power.addMaterialsInfo?((0,a.wg)(),(0,a.iD)("p",{key:0,onClick:t[0]||(t[0]=(...t)=>e.input&&e.input(...t))},"手动输入农资信息")):(0,a.kq)("",!0),e.$store.state.power.selectMaterialsInfo?((0,a.wg)(),(0,a.iD)("p",{key:1,onClick:t[1]||(t[1]=(...t)=>e._import&&e._import(...t))},"选择平台农资信息")):(0,a.kq)("",!0)])])),_:1},8,["before-close","modelValue"]),(0,a.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showInput,"onUpdate:modelValue":t[9]||(t[9]=t=>e.showInput=t),title:"手动输入农资信息",width:"600px"},{default:(0,a.w5)((()=>[(0,a._)("div",n,[(0,a._)("div",r,[(0,a.Wm)(v,{model:e.form,"label-width":"70px"},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{label:"农资名称"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,{modelValue:e.form.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.title=t),placeholder:"请输入农资名称"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(y,{label:"农资类型"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{style:{width:"450px"},modelValue:e.defaultType,"onUpdate:modelValue":t[4]||(t[4]=t=>e.defaultType=t),placeholder:"请选择农资类型"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.typeList,(e=>((0,a.wg)(),(0,a.j4)(k,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(y,{label:"生产厂家"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,{modelValue:e.form.company,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.company=t),placeholder:"请输入生产厂家"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(y,{label:"规格"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{span:18},{default:(0,a.w5)((()=>[(0,a.Wm)(s,{modelValue:e.form.weightNum,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.weightNum=t),placeholder:"请输入规格",class:"input-with-select"},{append:(0,a.w5)((()=>[(0,a.Wm)(b,{modelValue:e.defaultWeight,"onUpdate:modelValue":t[6]||(t[6]=t=>e.defaultWeight=t),placeholder:"-",style:{width:"75px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.weightList,(e=>((0,a.wg)(),(0,a.j4)(k,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(_,{span:2,style:{"text-align":"center"}},{default:(0,a.w5)((()=>[d])),_:1}),(0,a.Wm)(_,{span:4},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{modelValue:e.defaultUnit,"onUpdate:modelValue":t[8]||(t[8]=t=>e.defaultUnit=t),placeholder:"-",style:{width:"75px"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.unitList,(e=>((0,a.wg)(),(0,a.j4)(k,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])]),(0,a._)("div",m,[(0,a.Wm)(x,{type:"primary",onClick:e.submitA,loading:e.saveing},{default:(0,a.w5)((()=>[p])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue"]),(0,a.Wm)(l,{"custom-class":"stockRegBox","before-close":e.onClose,"append-to-body":"",modelValue:e.showImport,"onUpdate:modelValue":t[11]||(t[11]=t=>e.showImport=t),title:e.title||"选择平台农资信息",width:"800px"},{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a._)("div",h,[(0,a.Wm)(s,{modelValue:e.searchKey,"onUpdate:modelValue":t[10]||(t[10]=t=>e.searchKey=t),style:{width:"360px"},placeholder:"关键字搜索：农资类型、农资名称、厂家名称"},null,8,["modelValue"]),(0,a.Wm)(x,{style:{"margin-left":"10px"},type:"primary",plain:"",onClick:e.getData},{default:(0,a.w5)((()=>[c])),_:1},8,["onClick"])]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(U,{size:"large",data:e.tableData,ref:"table","max-height":"500",style:{width:"100%"}},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{type:"selection",width:"55"}),(0,a.Wm)(V,{prop:"agriculturalBo.title",label:"农资名称"}),(0,a.Wm)(V,{prop:"agriculturalBo.agriculturalCategory",label:"农资类型",width:"150"}),(0,a.Wm)(V,{prop:"agriculturalBo.manufacturers",label:"生产厂家"}),(0,a.Wm)(V,{label:"规格",width:"150"},{default:(0,a.w5)((e=>[(0,a.Uk)((0,i.zw)(e.row.agriculturalBo.agriculturalCount)+(0,i.zw)(e.row.agriculturalBo.unitweight)+"/"+(0,i.zw)(e.row.agriculturalBo.unitmeasurement),1)])),_:1})])),_:1},8,["data"])),[[W,e.loading]]),(0,a._)("div",w,[(0,a.Wm)(x,{type:"primary",onClick:e.submitB,loading:e.submitting},{default:(0,a.w5)((()=>[f])),_:1},8,["onClick","loading"])])])])),_:1},8,["before-close","modelValue","title"])])}var k={name:"stockReg",props:["default","needSubmit","title"],data(){return{loading:!1,showDetailBox:!0,showInput:!1,showImport:!1,form:{},defaultType:"",typeList:[],defaultUnit:"",unitList:[],defaultWeight:"",weightList:[],searchKey:"",tableData:[],saveing:!1,submitting:!1}},mounted(){0==this.default&&this.input(),1==this.default&&this._import()},methods:{onClose(){this.$emit("closeReg",0),this.showDetailBox=!1,this.showInput=!1,this.showImport=!1},input(){let e=this;e.showDetailBox=!1,e.showInput=!0,e.showImport=!1;const t=async function(){await e.getTypeList(),await e.getUnitList(),await e.getWeightList()};t()},_import(){this.showDetailBox=!1,this.showInput=!1,this.showImport=!0,console.log(2),this.getData()},getData(){this.loading=!0,this.ajax.post("/api/v1/adam/farmLand/agriculturalSearch-list",{pageNum:1,pageSize:100,param:{categoryId:0,inventory:0,keyWord:this.searchKey}}).then((e=>{this.loading=!1,this.tableData=e.data.map((e=>(e.agriculturalBo=e.agriculturalBo||{},e)))}))},getTypeList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getAgriculturalCategory").then((t=>{this.typeList=t.data,e()}))}))},getUnitList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getUnitMeasurement").then((t=>{this.unitList=t.data,e()}))}))},getWeightList(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getWeightUnit").then((t=>{this.weightList=t.data,e()}))}))},submitA(){let e="";this.typeList.map((t=>{t.id==this.defaultType&&(e=t.title)}));let t="";this.weightList.map((e=>{e.id==this.defaultWeight&&(t=e.title)}));let l="";this.unitList.map((e=>{e.id==this.defaultUnit&&(l=e.title)}));let a={agriculturalCategory:e,agriculturalCategoryId:this.defaultType,title:this.form.title,manufacturers:this.form.company,agriculturalCount:this.form.weightNum,unitweight:t,unitweightid:this.defaultWeight,unitmeasurement:l,unitmeasurementid:this.defaultUnit};this.saveing=!0,this.ajax.post("/api/v1/adam/farmLand/saveDefinition",{agriculturalBoList:[a]}).then((e=>{this.saveing=!1,200==e.code&&(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose())}))},submitB(){if("undefined"==typeof this.needSubmit)this.$emit("onSubmit",this.$refs.table.getSelectionRows()),this.onClose();else{let e=this.$refs.table.getSelectionRows().map((e=>e.id));if(0==e.length)return void this.$message.warning("请选择农资");this.submitting=!0,this.ajax.post("/api/v1/adam/farmLand/savePlatform",{id:e}).then((e=>{this.submitting=!1,200==e.code?(this.$message.success("保存成功"),this.$emit("onSave"),this.onClose()):this.$message.warning(e.message)}))}}}},b=l(8118);const _=(0,b.Z)(k,[["render",y],["__scopeId","data-v-29667d18"]]);var v=_}}]);
//# sourceMappingURL=648.f699f312.js.map