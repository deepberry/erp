"use strict";(self["webpackChunktitan2"]=self["webpackChunktitan2"]||[]).push([[637],{9193:function(e,t,l){l.d(t,{Z:function(){return K}});var i=l(6252),a=l(3577),s=l(9963);const r=e=>((0,i.dD)("data-v-25f4a2dc"),e=e(),(0,i.Cn)(),e),o={class:"main"},u={class:"tab"},n={class:"tabbox tab1"},d=["onClick"],c={class:"itemBox"},m={class:"tag"},g=(0,i.Uk)(" 使用量："),p={class:"btn"},h=(0,i.Uk)("    取消    "),w=(0,i.Uk)("    确定    "),y={class:"tabbox tab2"},f={class:"item"},v=r((()=>(0,i._)("div",{class:"title"},[(0,i._)("span",null,"*"),(0,i.Uk)(" 农资名称：")],-1))),k={class:"content"},_={class:"item"},C=r((()=>(0,i._)("div",{class:"title"},[(0,i._)("span",null,"*"),(0,i.Uk)(" 农资类型：")],-1))),b={class:"content"},D={class:"contentA"},U={key:0,class:"contentB"},V={class:"item"},B=r((()=>(0,i._)("div",{class:"title"},[(0,i._)("span",null,"*"),(0,i.Uk)(" 使用量：")],-1))),T={class:"content"},x={class:"contentA"},$={class:"contentB"},z={class:"item"},I=r((()=>(0,i._)("div",{class:"title"},"厂家：",-1))),N={class:"content"},j={class:"btn"},q=(0,i.Uk)("保存并继续添加"),W=(0,i.Uk)("    保存    ");function A(e,t,l,r,A,E){const M=(0,i.up)("el-empty"),F=(0,i.up)("el-input"),K=(0,i.up)("el-button"),H=(0,i.up)("el-option"),S=(0,i.up)("el-select"),Y=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(Y,{"before-close":E.onClose,"append-to-body":"",modelValue:A.showDetailBox,"onUpdate:modelValue":t[10]||(t[10]=e=>A.showDetailBox=e),title:"添加农资",width:"740px"},{default:(0,i.w5)((()=>[(0,i._)("div",o,[(0,i._)("div",u,[(0,i._)("span",{class:(0,a.C_)(0==A.tab?"active":""),onClick:t[0]||(t[0]=e=>A.tab=0)},"选择已领取农资",2),(0,i._)("span",{class:(0,a.C_)(1==A.tab?"active":""),onClick:t[1]||(t[1]=e=>A.tab=1)},"手动输入农资信息",2)]),(0,i.wy)((0,i._)("div",n,[0==A.list.length?((0,i.wg)(),(0,i.j4)(M,{key:0,description:"暂无数据"})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(A.list,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"item",key:e.id},[(0,i._)("i",{onClick:t=>e.use=!e.use,class:(0,a.C_)(e.use?"erp erpduoxuankuangxuanzhong":"erp erpduoxuan-01")},null,10,d),(0,i._)("div",c,[(0,i._)("div",null,[(0,i._)("span",null,[(0,i.Uk)((0,a.zw)(e.agriculturalBo.title)+" ",1),(0,i._)("span",m,(0,a.zw)(e.agriculturalBo.agriculturalCategory),1)]),(0,i._)("span",null,"("+(0,a.zw)(e.agriculturalBo.agriculturalCount)+(0,a.zw)(e.agriculturalBo.unitweight)+"/"+(0,a.zw)(e.agriculturalBo.unitmeasurement)+")",1),(0,i._)("span",null,(0,a.zw)(e.agriculturalBo.manufacturers),1)]),(0,i._)("div",null,[(0,i._)("span",null," 库存量： "+(0,a.zw)(e.agriculturalUnit)+(0,a.zw)(e.agriculturalBo.unitmeasurement)+"（共"+(0,a.zw)(e.agriculturalCount)+(0,a.zw)(e.agriculturalBo.unitweight)+"） ",1),(0,i._)("div",null,[g,(0,i.Wm)(F,{style:{width:"160px"},onBlur:l=>e.useNum>e.agriculturalCount?E.inputNum(t):()=>{},modelValue:e.useNum,"onUpdate:modelValue":t=>e.useNum=t,placeholder:"输入数量"},{append:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(e.agriculturalBo.unitweight),1)])),_:2},1032,["onBlur","modelValue","onUpdate:modelValue"])])])])])))),128)),(0,i._)("div",p,[(0,i.Wm)(K,{type:"primary",plain:"",onClick:E.onClose},{default:(0,i.w5)((()=>[h])),_:1},8,["onClick"]),(0,i.Wm)(K,{type:"primary",onClick:E.chose},{default:(0,i.w5)((()=>[w])),_:1},8,["onClick"])])],512),[[s.F8,0==A.tab]]),(0,i.wy)((0,i._)("div",y,[(0,i._)("div",f,[v,(0,i._)("div",k,[(0,i.Wm)(F,{modelValue:A.title,"onUpdate:modelValue":t[2]||(t[2]=e=>A.title=e),placeholder:"请输入"},null,8,["modelValue"])])]),(0,i._)("div",_,[C,(0,i._)("div",b,[(0,i._)("div",D,[(0,i.Wm)(S,{style:{width:"100%"},modelValue:A.currentAgriculturalCategory,"onUpdate:modelValue":t[3]||(t[3]=e=>A.currentAgriculturalCategory=e),placeholder:"请选择农资类型"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(A.agriculturalCategory,(e=>((0,i.wg)(),(0,i.j4)(H,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),-1==A.currentAgriculturalCategory?((0,i.wg)(),(0,i.iD)("div",U,[(0,i.Wm)(F,{modelValue:A.diyAgriculturalCategory,"onUpdate:modelValue":t[4]||(t[4]=e=>A.diyAgriculturalCategory=e),placeholder:"请输入"},null,8,["modelValue"])])):(0,i.kq)("",!0)])]),(0,i._)("div",V,[B,(0,i._)("div",T,[(0,i._)("div",x,[(0,i.Wm)(F,{modelValue:A.useNum,"onUpdate:modelValue":t[5]||(t[5]=e=>A.useNum=e),placeholder:"请输入使用量"},null,8,["modelValue"])]),(0,i._)("div",$,[(0,i.Wm)(S,{style:{width:"100%"},modelValue:A.currentUnitMeasurement,"onUpdate:modelValue":t[6]||(t[6]=e=>A.currentUnitMeasurement=e),placeholder:"单位"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(A.unitMeasurement,(e=>((0,i.wg)(),(0,i.j4)(H,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])]),(0,i._)("div",z,[I,(0,i._)("div",N,[(0,i.Wm)(F,{modelValue:A.company,"onUpdate:modelValue":t[7]||(t[7]=e=>A.company=e),placeholder:"请输入厂家"},null,8,["modelValue"])])]),(0,i._)("div",j,[(0,i.Wm)(K,{type:"primary",plain:"",onClick:t[8]||(t[8]=e=>E.save(0))},{default:(0,i.w5)((()=>[q])),_:1}),(0,i.Wm)(K,{type:"primary",onClick:t[9]||(t[9]=e=>E.save(1))},{default:(0,i.w5)((()=>[W])),_:1})])],512),[[s.F8,1==A.tab]])])])),_:1},8,["before-close","modelValue"])}var E={props:["id"],emits:["close","save","chose"],data(){return{showDetailBox:!0,tab:0,list:[],title:"",agriculturalCategory:[],currentAgriculturalCategory:"",diyAgriculturalCategory:"",unitMeasurement:[],currentUnitMeasurement:"",useNum:"",company:""}},mounted(){this.getAgriculturalUser(),this.getAgriculturalCategory(),this.getUnitMeasurement()},methods:{inputNum(e){this.$message.warning("库存不足"),this.list[e].useNum=""},chose(){let e=[],t=null;this.list.map((l=>{l.use&&(l.useNum?e.push(l):t=l)})),console.log(e),t?this.$message.warning(`请输入[${t.agriculturalBo.title}]的使用数量`):0!=e.length?(e=e.map((e=>({agriculturalType:e.agriculturalBo.agriculturalCategory,agricultural:e.agriculturalBo.title,agriculturalId:e.agriculturalBo.id,agriculturalCount:e.useNum,agriculturalUnit:e.agriculturalBo.unitweight,definition:0,agriculturalUnitId:e.agriculturalBo.unitweightid,isUse:0,manufacturers:e.agriculturalBo.manufacturers}))),this.$emit("chose",e),this.onClose()):this.$message.warning("请选择农资")},save(e){let t={agricultural:this.title,agriculturalId:"",agriculturalCount:this.useNum,agriculturalUnit:"",definition:1,agriculturalUnitId:this.currentUnitMeasurement,isUse:0,manufacturers:this.company};this.unitMeasurement.map((e=>{e.id==this.currentUnitMeasurement&&(t.agriculturalUnit=e.title)})),t.agricultural?this.currentAgriculturalCategory?-1!=this.currentAgriculturalCategory||this.diyAgriculturalCategory?t.agriculturalCount?(-1==this.currentAgriculturalCategory?(t.agriculturalType=this.diyAgriculturalCategory,t.id=""):(t.id=this.currentAgriculturalCategory,this.agriculturalCategory.map((e=>{e.id==t.id&&(t.agriculturalType=e.title)}))),this.$emit("save",t),1==e?this.onClose():(this.title="",this.currentAgriculturalCategory="",this.useNum="",this.company="")):this.$message.warning("请输入使用量"):this.$message.warning("请输入农资类型"):this.$message.warning("请选择农资类型"):this.$message.warning("请输入农资标题")},onClose(e=null){"function"==typeof e&&(e=null),this.$emit("close",e),this.showDetailBox=!1},getUnitMeasurement(){this.ajax.post("/api/v1/adam/farm/getWeightUnit").then((e=>{this.unitMeasurement=e.data,this.currentUnitMeasurement=e.data[0].id}))},getAgriculturalCategory(){this.ajax.post("/api/v1/adam/farm/getAgriculturalCategory").then((e=>{this.agriculturalCategory=e.data,this.agriculturalCategory.unshift({id:-1,title:"自定义"})}))},getAgriculturalUser(){this.ajax.post("/api/v1/adam/farmLand/agriculturalUser-list",{pageNum:1,pageSize:100,param:{endTime:"",id:0,keyWord:"",startTime:""}}).then((e=>{this.list=e.data}))}}},M=l(8118);const F=(0,M.Z)(E,[["render",A],["__scopeId","data-v-25f4a2dc"]]);var K=F},2637:function(e,t,l){l.d(t,{Z:function(){return C}});var i=l(6252),a=l(3577);const s=e=>((0,i.dD)("data-v-dd07b02c"),e=e(),(0,i.Cn)(),e),r={class:"search"},o=(0,i.Uk)("查询"),u={class:"list"},n=["onClick"],d={class:"itemInner"},c={class:"itemTitle"},m={class:"itemInner"},g=s((()=>(0,i._)("p",null,null,-1))),p={class:"itemInner btm"},h={key:0,class:"foot"};function w(e,t,l,s,w,y){const f=(0,i.up)("el-input"),v=(0,i.up)("el-button"),k=(0,i.up)("el-empty"),_=(0,i.up)("PlantCropsDetailCDialogDetail"),C=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(C,{modelValue:w.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>w.dialogVisible=e),title:l.title,width:"30%","before-close":y.handleClose,"append-to-body":""},{default:(0,i.w5)((()=>[(0,i._)("div",r,[(0,i.Wm)(f,{modelValue:w.searchKey,"onUpdate:modelValue":t[0]||(t[0]=e=>w.searchKey=e),placeholder:"关键字搜索：农事类型、农资、备注"},null,8,["modelValue"]),(0,i.Wm)(v,{type:"primary",style:{"margin-left":"15px"},plain:"",onClick:y.getData},{default:(0,i.w5)((()=>[o])),_:1},8,["onClick"])]),(0,i._)("div",u,[0==w.list.length?((0,i.wg)(),(0,i.j4)(k,{key:0,description:"暂无数据"})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.list,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"item",key:e.id,style:(0,a.j5)({cursor:"农资使用统计"==l.title?"pointer":""}),onClick:t=>y.detail(e.id)},[(0,i._)("div",d,[(0,i._)("p",c,(0,a.zw)(e.title),1),(0,i._)("p",null,(0,a.zw)(e.workTime),1)]),(0,i._)("div",m,[(0,i._)("p",null,"备注："+(0,a.zw)(e.workText),1),g]),(0,i._)("div",p,[(0,i._)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.farmUseBos,(e=>((0,i.wg)(),(0,i.iD)("p",{key:e.id},[(0,i._)("span",null,(0,a.zw)(e.agricultural),1),(0,i._)("span",null,(0,a.zw)(e.agriculturalCount)+(0,a.zw)(e.agriculturalUnit),1)])))),128))]),(0,i._)("p",null,(0,a.zw)(e.userName),1)]),"工时使用统计"==l.title?((0,i.wg)(),(0,i.iD)("div",h,(0,a.zw)(e.workHour)+"工时",1)):(0,i.kq)("",!0)],12,n)))),128))]),w.showDetail?((0,i.wg)(),(0,i.j4)(_,{key:0,title:w.detailTitle,id:w.detailId,onClose:y.closeDetail},null,8,["title","id","onClose"])):(0,i.kq)("",!0)])),_:1},8,["modelValue","title","before-close"])}var y=l(2335),f=l(8717),v={props:["title","id","title2"],data(){return{dialogVisible:!0,searchKey:"",list:[],showDetail:!1,detailTitle:"",detailId:""}},mounted(){this.getData()},components:{PlantCropsDetailCDialogDetail:f.Z},methods:{handleClose(){this.dialogVisible=!1,this.$emit("close")},detail(e){"农资使用统计"==this.title&&(this.detailTitle="施肥详情",this.showDetail=!0,this.detailId=e,console.log(e))},closeDetail(){setTimeout((()=>{this.showDetail=!1}),300)},getData(){let e={},t="";"农资使用统计"==this.title?(e={agriculturalId:this.id,endTime:"",keyWord:this.searchKey,plantsId:this.$route.query.id,startTime:""},t="/api/v1/adam/farm/getFarmRecordByAgriculturalId"):(e={title:this.title2,endTime:"",farmId:this.id||1,keyWord:this.searchKey,plantsId:this.$route.query.id,startTime:""},t="/api/v1/adam/farm/getFarmWorkRecordByFarmId"),this.ajax.post(t,e).then((e=>{this.list=e.data.map((e=>(e.workTime=y.Z.time("y-m-d",e.workTime),e)))}))}}},k=l(8118);const _=(0,k.Z)(v,[["render",w],["__scopeId","data-v-dd07b02c"]]);var C=_},8717:function(e,t,l){l.d(t,{Z:function(){return ve}});var i=l(6252),a=l(3577);const s=e=>((0,i.dD)("data-v-47ef22b8"),e=e(),(0,i.Cn)(),e),r={class:"btn"},o={class:"form"},u={class:"item"},n=s((()=>(0,i._)("p",{class:"title"},"种植植物：",-1))),d={class:"content"},c={class:"text"},m={class:"item"},g=s((()=>(0,i._)("p",{class:"title"},"农事类型：",-1))),p={class:"content"},h={class:"item"},w={key:0,class:"title"},y={key:1,class:"content"},f=s((()=>(0,i._)("p",{class:"text"},"暂无数据",-1))),v=[f],k={key:2,class:"title"},_={key:3,class:"content"},C=(0,i.Uk)("公斤"),b={key:4,class:"content nz"},D={class:"tag"},U=["onClick"],V=s((()=>(0,i._)("i",{class:"erp erpicon_tianjia"},null,-1))),B=(0,i.Uk)(" 添加农资 "),T=[V,B],x={class:"item"},$=s((()=>(0,i._)("p",{class:"title"},"工时：",-1))),z={class:"content"},I={class:"item"},N=s((()=>(0,i._)("p",{class:"title"},"作业方式：",-1))),j={class:"content"},q={class:"item"},W=s((()=>(0,i._)("p",{class:"title"},"操作时间：",-1))),A={class:"content"},E={class:"item"},M=s((()=>(0,i._)("p",{class:"title"},"操作人：",-1))),F={class:"content"},K={class:"item"},H=s((()=>(0,i._)("p",{class:"title"},"农事照片：",-1))),S={key:0,class:"content"},Y=["src"],Z={key:0,class:"text"},R={key:1,class:"content"},L={class:"pics"},O=["src"],P=["onClick"],J={key:0,class:"upload"},G={key:1},Q=s((()=>(0,i._)("i",{class:"erp erpshangchuan"},null,-1))),X=[Q],ee={key:2},te={class:"item itemBig"},le=s((()=>(0,i._)("p",{class:"title"},"备注：",-1))),ie={class:"content"},ae={class:"item itemBig"},se=s((()=>(0,i._)("p",{class:"title"},"环境数据：",-1))),re={class:"content hj",style:{width:"460px"}},oe=["src"],ue={key:0,class:"text"},ne={class:"item itemBig"},de=s((()=>(0,i._)("p",{class:"title"},"现场照片：",-1))),ce={class:"content hj",style:{width:"460px"}},me=s((()=>(0,i._)("p",{class:"text"},"暂无数据",-1)));function ge(e,t,l,s,f,V){const B=(0,i.up)("el-button"),Q=(0,i.up)("el-option"),ge=(0,i.up)("el-select"),pe=(0,i.up)("el-input"),he=(0,i.up)("el-date-picker"),we=(0,i.up)("el-progress"),ye=(0,i.up)("PlantCropsDetailBDialogChose"),fe=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(fe,{modelValue:f.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>f.dialogVisible=e),title:l.title,width:"580px","before-close":V.handleClose,"append-to-body":""},{default:(0,i.w5)((()=>[(0,i._)("div",r,[e.$store.state.power.editFarmRecordBtn?((0,i.wg)(),(0,i.j4)(B,{key:0,type:"primary",onClick:V.editButton},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(f.isEdit?"保存":"编辑"),1)])),_:1},8,["onClick"])):(0,i.kq)("",!0),e.$store.state.power.delFarmRecordBtn?((0,i.wg)(),(0,i.j4)(B,{key:1,type:"primary",plain:"",onClick:V.del},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(f.isEdit?"取消":"删除"),1)])),_:1},8,["onClick"])):(0,i.kq)("",!0)]),(0,i._)("div",o,[(0,i._)("div",u,[n,(0,i._)("div",d,[(0,i._)("p",c,(0,a.zw)(f.form.categoryTitle+"-"+f.form.address),1)])]),(0,i._)("div",m,[g,(0,i._)("div",p,[(0,i.Wm)(ge,{disabled:!f.isEdit,style:{width:"100%"},modelValue:f.form.farmId,"onUpdate:modelValue":t[0]||(t[0]=e=>f.form.farmId=e),placeholder:"请选择农事类型"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.farmType,(e=>((0,i.wg)(),(0,i.j4)(Q,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])]),(0,i._)("div",h,["采摘"!=f.form.title?((0,i.wg)(),(0,i.iD)("p",w,"使用农资：")):(0,i.kq)("",!0),0!=f.form.farmUseBos.length||f.isEdit||"采摘"==f.form.title?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",y,v)),"采摘"==f.form.title?((0,i.wg)(),(0,i.iD)("p",k,"采摘重量：")):(0,i.kq)("",!0),"采摘"==f.form.title?((0,i.wg)(),(0,i.iD)("div",_,[(0,i.Wm)(pe,{disabled:!f.isEdit,modelValue:f.form.pickCount,"onUpdate:modelValue":t[1]||(t[1]=e=>f.form.pickCount=e),placeholder:"输入采摘重量"},{append:(0,i.w5)((()=>[C])),_:1},8,["disabled","modelValue"])])):(0,i.kq)("",!0),f.form.farmUseBos.length>0||f.isEdit&&"采摘"!=f.form.title?((0,i.wg)(),(0,i.iD)("div",b,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.form.farmUseBos,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"nzItem",key:e.id},[(0,i._)("div",{class:"nzBox",style:(0,a.j5)({width:f.isEdit?"400px":"438px"})},[(0,i._)("span",null,[(0,i._)("span",D,(0,a.zw)(e.agriculturalType),1)]),(0,i._)("span",null,(0,a.zw)(e.agricultural),1),(0,i._)("span",null,(0,a.zw)(e.agriculturalCount)+(0,a.zw)(e.agriculturalUnit),1)],4),f.isEdit?((0,i.wg)(),(0,i.iD)("i",{key:0,class:"erp erpshanchu",onClick:e=>V.removeNz(t)},null,8,U)):(0,i.kq)("",!0)])))),128)),f.isEdit&&"采摘"!=f.form.title?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"nzAdd",onClick:t[2]||(t[2]=e=>f.showChose=!0)},T)):(0,i.kq)("",!0)])):(0,i.kq)("",!0)]),(0,i._)("div",x,[$,(0,i._)("div",z,[(0,i.Wm)(pe,{disabled:!f.isEdit,modelValue:f.form.workHour,"onUpdate:modelValue":t[3]||(t[3]=e=>f.form.workHour=e),placeholder:"请输入工时"},null,8,["disabled","modelValue"])])]),(0,i._)("div",I,[N,(0,i._)("div",j,[(0,i.Wm)(ge,{disabled:!f.isEdit,style:{width:"100%"},modelValue:f.form.workType,"onUpdate:modelValue":t[4]||(t[4]=e=>f.form.workType=e),placeholder:"请选择作业方式"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.operatingType,(e=>((0,i.wg)(),(0,i.j4)(Q,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["disabled","modelValue"])])]),(0,i._)("div",q,[W,(0,i._)("div",A,[(0,i.Wm)(he,{disabled:!f.isEdit,style:{width:"100%"},modelValue:f.form.workTime,"onUpdate:modelValue":t[5]||(t[5]=e=>f.form.workTime=e),type:"date",placeholder:"请选择操作时间"},null,8,["disabled","modelValue"])])]),(0,i._)("div",E,[M,(0,i._)("div",F,[(0,i.Wm)(pe,{disabled:!f.isEdit,modelValue:f.form.userName,"onUpdate:modelValue":t[6]||(t[6]=e=>f.form.userName=e),placeholder:"请输入操作人"},null,8,["disabled","modelValue"])])]),(0,i._)("div",K,[H,f.isEdit?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",S,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.form.image,((e,t)=>((0,i.wg)(),(0,i.iD)("img",{class:"picsimg",key:t,src:e,alt:""},null,8,Y)))),128)),0==f.form.image.length?((0,i.wg)(),(0,i.iD)("p",Z,"暂无数据")):(0,i.kq)("",!0)])),f.isEdit?((0,i.wg)(),(0,i.iD)("div",R,[(0,i._)("div",L,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.form.image,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"img",key:t},[(0,i._)("img",{src:e,alt:""},null,8,O),(0,i._)("i",{class:"erp erpguanbi",onClick:e=>V.removeImg(t)},null,8,P)])))),128)),f.form.image.length<2?((0,i.wg)(),(0,i.iD)("div",J,[f.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("input",{key:0,onChange:t[7]||(t[7]=(...e)=>V.uploadFile&&V.uploadFile(...e)),ref:"file",type:"file"},null,544)),f.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("p",G,X)),f.uploading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("p",ee,"点击上传照片")),f.uploading?((0,i.wg)(),(0,i.j4)(we,{key:3,width:90,type:"circle",percentage:f.percentage},null,8,["percentage"])):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])])):(0,i.kq)("",!0)]),(0,i._)("div",te,[le,(0,i._)("div",ie,[(0,i.Wm)(pe,{disabled:!f.isEdit,modelValue:f.form.workText,"onUpdate:modelValue":t[8]||(t[8]=e=>f.form.workText=e),placeholder:"请输入备注"},null,8,["disabled","modelValue"])])]),(0,i._)("div",ae,[se,(0,i._)("div",re,[(0,i._)("div",{class:"hjbox",style:(0,a.j5)({width:150*f.form.smartDevice.length+"px"})},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.form.smartDevice,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"huanjing",key:e.id},[(0,i._)("img",{src:V.getIconUrl(e.icon),alt:""},null,8,oe),(0,i._)("p",null,(0,a.zw)(e.value||" ")+(0,a.zw)(e.unit||" "),1),(0,i._)("p",null,(0,a.zw)(e.displayName),1)])))),128))],4),0==f.form.smartDevice.length?((0,i.wg)(),(0,i.iD)("p",ue,"暂无数据")):(0,i.kq)("",!0)])]),(0,i._)("div",ne,[de,(0,i._)("div",ce,[(0,i.kq)("",!0),me])])]),f.showChose?((0,i.wg)(),(0,i.j4)(ye,{key:0,onSave:V.save,onChose:V.chose,onClose:V.closeChose},null,8,["onSave","onChose","onClose"])):(0,i.kq)("",!0)])),_:1},8,["modelValue","title","before-close"])}var pe=l(3483),he=l(9193),we={props:["title","id"],emits:["load","success","close"],data(){return{dialogVisible:!0,searchKey:"",list:[],imgs:[],form:{image:[],farmUseBos:[],smartDevice:[]},farmType:[],operatingType:[],isEdit:!1,uploading:!1,percentage:0,showChose:!1}},components:{PlantCropsDetailBDialogChose:he.Z},mounted(){let e=this,t=async function(){await e.getData(),await e.getFarmType(),await e.getOperatingType(),await e.getFarmRecordImg()};t()},computed:{imgSpace(){let e=0;return e=4-this.imgs.length%4,e}},methods:{getFarmRecordImg(){this.ajax.post("/api/v1/adam/task/getFarmRecordImg",{growPlantId:this.$route.query.id}).then((e=>{let t=[];e.data.map((e=>{e=e.split(","),t=[...t,...e]})),this.imgs=t}))},editButton(){if(this.isEdit){let e=JSON.parse(JSON.stringify(this.form));e.smartDevice=JSON.stringify(e.smartDevice),e.image=e.image.join(","),this.ajax.post("/api/v1/adam/farm/editeFarm",e).then((e=>{200==e.code?(this.$message.success("保存成功"),this.isEdit=!1,this.$emit("load")):this.$message.error("编辑失败，请稍后再试")}))}else this.isEdit=!0},closeChose(){setTimeout((()=>{this.showChose=!1}),300)},removeNz(e){this.form.farmUseBos.splice(e,1)},getIconUrl(e){return`https://cdn.deepberry.cn/img/common/node-props/${e||"default"}.svg`},chose(e){console.log(e);let t=[...this.form.farmUseBos,...e].map((e=>(e.agriculturalCount=Number(e.agriculturalCount),e)));var l=function(e){for(var t=[],l=[],i=0;i<e.length;i++)l.indexOf(e[i].agricultural)>-1?t[l.indexOf(e[i].agricultural)].agriculturalCount+=e[i].agriculturalCount:(l.push(e[i].agricultural),t.push(e[i]));return t};this.form.farmUseBos=l(t)},save(e){this.form.farmUseBos.push(e)},removeImg(e){console.log(e),this.form.image.splice(e,1)},uploadFile(){this.uploading=!0;let e=this.$refs.file.files[0];(0,pe.Z)(e,`erp/farmingHistory/${e.name}`).then((e=>{e.url&&(this.form.image.push(e.url),this.uploading=!1,this.percentage=0)}))},del(){this.isEdit?(this.isEdit=!1,this.getData()):this.ajax.post("/api/v1/adam/farm/delFarmRecordById",{id:this.id}).then((e=>{200==e.code?(this.$message.success("删除成功"),this.handleClose(),this.$emit("load")):this.$message.error(e.message)}))},handleClose(){this.dialogVisible=!1,this.$emit("close")},getData(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getFarmRecordById",{id:this.id}).then((t=>{t.data.image=t.data.image.length>0?t.data.image.split(","):[],t.data.smartDevice=JSON.parse(t.data.smartDevice)||[],this.form=t.data,console.log(this.form),e()}))}))},getFarmType(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getFarmType").then((t=>{this.farmType=t.data,e()}))}))},getOperatingType(){return new Promise(((e,t)=>{this.ajax.post("/api/v1/adam/farm/getOperatingType").then((t=>{this.operatingType=t.data,e()}))}))}}},ye=l(8118);const fe=(0,ye.Z)(we,[["render",ge],["__scopeId","data-v-47ef22b8"]]);var ve=fe},2335:function(e,t){const l={to2:e=>Number(e)<10?`0${Number(e)}`:String(e),time(e="y-m-d",t=null){let l=t?new Date(t):new Date;return e=e.replace("y",l.getFullYear()),e=e.replace("m",this.to2(l.getMonth()+1)),e=e.replace("d",this.to2(l.getDate())),e=e.replace("h",this.to2(l.getHours())),e=e.replace("i",this.to2(l.getMinutes())),e=e.replace("s",this.to2(l.getSeconds())),e=e.replace("w",l.getDay()),e},monthLength(e=null){let t=1*this.time("y",e),l=this.to2(1*this.time("m",e)+1);if(13==l)return 31;{let e=new Date(`${t}-${l}-01`).getTime()-864e5;return Number(this.time("d",e))}},preMonthLenggth(e=null){let t=1*this.time("y",e),l=this.to2(1*this.time("m",e)),i=new Date(`${t}-${l}-01`).getTime()-864e5;return Number(this.time("d",i))},nextMonthLenggth(e=null){let t=1*this.time("y",e),l=this.to2(1*this.time("m",e)+2),i=new Date(`${t}-${l}-01`).getTime()-864e5;return Number(this.time("d",i))},monthFirst(e=null){let t=this.time("y-m",e)+"-01";return this.time("y-m-d",t)},monthLast(e=null){let t=1*this.time("y",e),l=this.to2(1*this.time("m",e)+1),i=new Date(`${t}-${l}-01`).getTime()-864e5;return this.time("y-m-d",i)},preMonthToday(e=null){let t=Number(e.substr(0,4)),l=Number(e.substr(5,2)),i=Number(e.substr(8));return i>this.preMonthLenggth(`{y}-${l}-01`)&&(i=this.preMonthLenggth(`{y}-${l}-01`)),1==l?(t-=1,l=12):l-=1,`${t}-${l}-${i}`},nextMonthToday(e=null){let t=Number(e.substr(0,4)),l=Number(e.substr(5,2)),i=Number(e.substr(8));return i>this.nextMonthLenggth(`{y}-${l}-01`)&&(i=this.nextMonthLenggth(`{y}-${l}-01`)),12==l?(t+=1,l=1):l+=1,`${t}-${l}-${i}`},timeout(e){},timeRemaining(e,t){return t-=parseInt((new Date).getTime()/1e3),this.unixToString(e,t)},unixToString(e,t){let i=parseInt(t/60/60/24),a=parseInt((t-86400*i)/3600),s=parseInt((t-86400*i-3600*a)/60),r=t-86400*i-3600*a-60*s;return e=e.replace("d",l.to2(l.low(i))),e=e.replace("h",l.to2(l.low(a))),e=e.replace("i",l.to2(l.low(s))),e=e.replace("s",l.to2(l.low(r))),e},low(e){return e<0?0:e},parse(e){return new Date(e)}};t["Z"]=l}}]);
//# sourceMappingURL=637.e965c8dd.js.map